---
title: "Trabajo Práctico Análisis de Duración"
author: "Karen Otterstedt Juan Sebastián Reines Urieles"
date: "2025-05-16"
output:
  bookdown::pdf_document2:
    smooth_scroll: true
    latex_engine: xelatex
    pandoc_args:
      - "--variable"
      - "lang=es"
    includes:
      in_header: header_dur.tex
    toc: false
    number_sections: false
---



```{r CHAT, include = F}
# TO DO: (alt + 127)
# ⌂ Introducción
# ⌂ Referenciar tablas
# ⌂ Centrar captions (de tablas y figuras)
# ⌂ Mejorar captions
# !(⌂) VER SI HAY QUE PONER TITULOS O NO EN LOS GRAFICOS
# !(⌂) Terminar de armar modelos y elegir uno
# !(⌂) RH, IC, etc
# !(⌂) Conclusiones



# YA ESTÁ HECHO (ignorar)
# PARA VER DE CATEGORIZAR COMORBILIDADES:
# Otro Estudio solo el 6% de los pacientes con enfermedad pulmonar obstructiva crónica no tenía otra afección médica crónica, con un promedio de 3.7 comorbilidades en pacientes con EPOC frente a 1.8 en controles sanos.
# 
# Otro estudio informó que más del 50% de una cohorte de 1522 pacientes con EPOC tenían 1 o 2 comorbilidades, el 15.8% tenía 3 o 4 comorbilidades y el 6.8% tenía 5 o más.
# FUENTE: https://scielo.isciii.es/scielo.php?script=sci_arttext&pid=S2529-850X2020001000010#B16

# Siento que dice cosas muy variadas VER QUE USAR
```


```{r Seteando_opciones, include = F}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE, 
  echo = F,
  fig.pos = 'H',
  fig.align = "center"
)

options(scipen = 999)
```

```{r Librerias, include = F}
# install.packages("bookdown")
library(readr)
library(tibble)
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(RColorBrewer) # Paletas
library(survival)  # Manejo datos de supervivencia 
library(survminer) # Crear gráficos con la función ggsurvplot()
library(survMisc)  # Para realizar el test de tendencia
library(ggpubr)    # Manejo de gráficos con ggplot (o ggsurvplot)

# Para que las tablas, etc esté en español
# tinytex::tlmgr_install("babel-spanish")


```

```{r Cargando_datos, include = F}
# Somos el grupo 7 así que nos corresponde el dataset 7:

datos <- read_csv("conjunto_grupo_7.csv")
summary(datos)

```

```{r Paletas_colores, include = F}
# Para ver paletas de colores: (Me gustó la RdBu, pero decime voooos)
# display.brewer.all()

# Para ver cuántos colores tiene la paleta:
# brewer.pal.info["RdBu", "maxcolors"]

#  brewer.pal.info["PRGn", "maxcolors"]

# Para que los muestre:

# display.brewer.pal(n = 11, "RdBu")
# prgn <- brewer.pal(n = 11, name = "PRGn")
# barplot(rep(1, 11), col = prgn, names.arg = prgn, las = 2)


# Para los nombres de los colores:
# brewer.pal(n = 11, name = "RdBu")

# Para ver qué color es cuál:
 # colores <- brewer.pal(11, "RdBu")
 # barplot(rep(1, 11), col = colores, names.arg = colores, las = 2)


# VER de ponerles nombres
# colores <- brewer.pal(11, "RdBu")
# names(colores) <- c("RojoOscuro", "Rojo", "Rosa", "Salmón", "Beige",
#                     "Gris", "Celeste", "AzulClaro", "Azul", "AzulOscuro", "AzulMuyOscuro")


```

# Introducción

*Variables*

-   ID: número de identificación del paciente

-   Tiempo: tiempo en meses desde el diagnóstico de la enfermedad
    crónica respiratoria hasta que presenta la complicación severa o
    termina su período de seguimiento

-   Complicacion: indicadora de la presencia de complicación severa (1:
    Presente, 0: Censura)

-   Edad: edad del paciente al momento de iniciar su seguimiento (en
    años)

-   Sexo: sexo biológico del paciente

-   Fumador: indicadora de si el paciente es fumador activo o no

-   Actividad: nivel de actividad física del paciente categorizado en
    actividad baja, moderada o alta

-   Comorbilidades: número de comorbilidades que presenta el paciente
    (el 0 indica que no tiene ninguna comorbilidad) presencia de dos o
    más enfermedades o afecciones en una misma persona al mismo tiempo

\newpage

# Análisis Descriptivo
<!-- VER DE AGREGAR ALGO ANTES DE TANTO GRÁFICO -->

```{r Edades, echo = F, fig.cap = 'Histograma de las edades de los pacientes al iniciar su seguimiento',out.width='70%', cache = T}

# Histograma:
ggplot(datos, aes(x = edad)) +
  geom_histogram(fill = "#92C5DE", color = "black") +
  theme_bw()+
  labs(y = "Frecuencia", x = "Edad")
```

En base la Figura \@ref(fig:Edades) se puede ver que la mayoría de los pacientes en el estudio son mayores a 60 años.


```{r tabla-sexo, echo = F}

datos %>% 
  group_by(sexo) %>% 
  # Para que ponga las primeras letras en mayúscula:
mutate(sexo = str_to_title(as.character(sexo))) %>% 
  summarise(n = n(),
            media = mean(tiempo),
            mediana = median(tiempo),
            sd = sd(tiempo)) %>% 
    mutate(
    across(where(is.numeric), # Para que sólo use 2 decimales
           ~round(.x, 2))) %>%
  kable(
    caption = "Medidas descriptivas de los pacientes de acuerdo a su sexo biológico",
    col.names = c("Sexo", "n", "Media", "Mediana", "Desvio estandar"),
    escape = F,
    label = "Tabla 1") %>%
  kable_styling(latex_options = "hold_position")


```
Puede verse (Tabla \@ref(tab:tabla-sexo)) que más de la mitad de los pacientes son de sexo femenino, y presentan tiempos mayores que sus contrapartes masculinas.


```{r graf-fumadores, echo  = F, fig.cap='No Fumadores vs Fumadores',out.width='70%', cache = T}

# Boxplot fumadores:
datos %>% 
  group_by(fumador) %>% 
  ggplot(aes(x = fumador, y = tiempo, fill = fumador)) + 
  geom_boxplot() +
  scale_fill_manual(values = c("#92C5DE", "#F4A582"))+
  labs (x = "Fumador", y = "Tiempo (en meses)") +
  scale_x_discrete(label = c("No", "Si")) +
  theme_bw() +
  theme(legend.position = "none") 

```

A pesar de presentar algunos outliers, se puede ver en la Figura \@ref(fig:graf-fumadores) que aquellos pacientes que padecieron cierta enfermedad crónica respiratoria y fuman presentaron menores tiempos de supervivencia que sus contrapartes que no fuman. Los pacientes que fuman en promedio presentan tiempos de supervivencia menores frente aquellos que no son fumadores activos.

```{r tabla-actividad, echo = FALSE, fig.cap = 'Nivel de actividad física de los pacientes', out.width='70%', cache = TRUE}

datos %>% 
  # str_to_title: Para que use los niveles de actividad con mayúscula la primera letra
  # factor(...., levels): para que las ordene
  mutate(
    actividad = str_to_title(as.character(actividad)), 
        actividad = factor(actividad,
                       levels = c("Alta", "Moderada", "Baja"))) %>% 
  group_by(actividad) %>% 
  summarise(
    n = n(),
    media = mean(tiempo),
    mediana = median(tiempo),
    sd = sd(tiempo)
  ) %>%
  mutate(
    across(where(is.numeric), # Para que sólo use 2 decimales
           ~round(.x, 2))) %>%
  kable(
    caption = "Medidas descriptivas de los pacientes de acuerdo a su nivel de actividad fisica",
    col.names = c("Actividad", "n", "Media", "Mediana", "Desvio estandar"),
    escape = F,
    label = "Tabla 2") %>%
  kable_styling(latex_options = "hold_position")
# responsive para que si usamos htlm se ajuste bien creo
# hold position para que no pase a otra hoja creo

```


En base a la \@ref(tab:tabla-actividad) pocas personas de las que participaron en el
estudio, realizan un nivel de actividad física alto, sin embargo, no hay
gran diferencia entre los tiempos medios de las personas que realizan
actividad de niveles moderada y baja.

```{r comorbilidad, echo = F, out.width='90%', cache = T}
# Comorbilidad:
# ggplot(datos, aes(x = tiempo, y = comorbilidades)) +
#   geom_count(aes(alpha = after_stat(n)), shape = 16, size = 3) +
#   scale_alpha(range = c(0.3, 1)) +
#   theme_bw()
```

<!-- En base a \@ref(fig:comorbilidad) se espera que el tiempo medio de -->
<!-- supervivencia para personas con mayor número de comorbilidades, sea -->
<!-- menor que para las personas con menos comorbilidades.  -->
<!-- No sé si me convence porque siento que hay pocas personas que tuvieron muchas comorbilidades, ponele que tuvieron 7 fue una, pero que tuvieron 6 comorbilidades fueron 3 y siento que podrían tener comportamiento parecido a las personas que tuvieron menos porque es como que hay dos en los primeros tiempos y uno que está más avanzado el estudio, pero siento que si hubiera más observaciones con esa cantidad de comorbilidades capaz serían parecidos a los otros  -->

<!-- Tienes razon, que prefieres que le pongamos que si aumentamos el tamaño este seria el tiempo medio o podemos decir que un numero alto de comorbilidades es de 4 en adelante y ahi ya queda xd-->

```{r categorizando-comorbilidades, include = F}

datos <- datos %>% 
  mutate(comorbilidades = case_when(
    comorbilidades <= 2 ~ "pocas",
    (comorbilidades == 3 | comorbilidades == 4) ~ "moderadas",
    T ~ "muchas")) %>% 
   mutate(
    comorbilidades = str_to_title(as.character(comorbilidades)),
    comorbilidades = factor(comorbilidades,
                  levels = c("Pocas", "Moderadas", "Muchas"))) 
```

Algunas cantidades de comorbilidades fueron poco frecuentes entre los pacientes, sólo 3 de los 110 no tuvieron, un paciente presentó 7, otros 3 presentaron 6, entre otros. Por lo que se agruparon grupos de pacientes de acuerdo a las $"Cantidades \ de  \ comorbilidades"$ que pasaron, en tres niveles: pocas (0-2 comorbilidades), moderadas (3-4 comorbilidades) y muchas ( > 5 comorbilidades). 



```{r tabla-comorbilidad, echo = F, cache = T}
datos %>% 
  mutate(comorbilidades = factor(comorbilidades)) %>% 
  group_by(comorbilidades) %>% 
  summarise(
    n = n(),
    media = mean(tiempo),
    mediana = median(tiempo),
    sd = sd(tiempo)
  ) %>%
  mutate(
    across(where(is.numeric),
           ~round(.x, 2))) %>%
kable(
  caption = "Medidas descriptivas de los pacientes de acuerdo a la cantidad de comorbilidades que presentaron",
  col.names = c("Comorbilidades", "n", "Media", "Mediana", "Desvío estándar"),
  escape = FALSE
) %>% 
  kable_styling(latex_options = c("responsive", "hold_position"))


# Sólo hay una persona que presentó 7 comorbilidades así que no se puede calcular el desvío 

```

En la Tabla \@ref(tab:tabla-comorbilidad) puede verse que mucha gente presentó pocas comorbilidades, y poca gente que presentó muchas. El tiempo medio de las personas que sufrieron una cantidad moderada de comorbilidades es mayor que los grupos restantes, pudiendo verse que le siguen los pacientes que sufrieron pocas, y, por último, con valores menores aquellos que presentaron muchas.


```{r sexoactividad,fig.cap="Actividad de acuerdo al sexo",out.width='90%', echo = F, cache = T}

# Intento de boxplot sexo y actividad física
datos %>% 
  mutate(
    sexo = str_to_title(as.character(sexo)),
    sexo = factor(sexo,
                  levels = c("Masculino", "Femenino")),
        actividad = str_to_title(as.character(actividad)),
    actividad = factor(actividad,
         levels = c("Baja", "Moderada", "Alta"))) %>% 
  group_by(sexo, actividad) %>%
  ggplot(aes(x = sexo, y = tiempo, fill = actividad))+
  geom_boxplot()+
  scale_fill_manual(values = c("#92C5DE", "brown3","#F4A582"))  +
  labs(x = "Sexo",
       y = "Tiempo (en meses)",
       fill = "Actividad") +
  theme_bw() 

# le cambie el color porque la verdad no los diferenciaba, pero despues ponele el color que tenia
```

En la Figura \@ref(fig:sexoactividad) puede verse que hay una gran dispersión entre las mujeres que realizan
bajo nivel de actividad física en los tiempos de supervivencia, a
diferencia de los hombres, que presentan tiempos mucho más concentrados.
Los pacientes masculinos que participaron del estudio y realizaban bajos niveles de actividad física no sobrevivieron los dos años, mientras que más del 25% de las mujeres que realizaban actividad con ese mismo nivel, sobrevivieron más de dos años de haberse iniciado en este estudio.

```{r actividadfumadores, echo = F, fig.cap = 'Tiempo de los pacientes teniendo en cuenta si son fumadores activos o no y el nivel de actividad física', out.width='90%', cache = T}

# Intento de actividad física y fumadores
datos %>% 
  mutate(
        actividad = str_to_title(as.character(actividad)),
    actividad = factor(actividad,
         levels = c("Baja", "Moderada", "Alta"))) %>% 
  group_by(fumador, actividad) %>%
  ggplot(aes(x = fumador, y = tiempo, fill = actividad))+
  geom_boxplot()+
  scale_fill_manual(values = c("#92C5DE", "#C2A5CF","#F4A582"))  +
  labs(x = "",
       y = "Tiempo (en meses)",
       fill = "Actividad") +
  scale_x_discrete(label = c("No Fumador", "Fumador")) +
  theme_bw() 

```

No parece verse diferencia (Figura \@ref(fig:actividadfumadores)) entre los distintos niveles de actividad física entre los pacientes que fuman. Así como tampoco parece presentarse diferencias en aquellos que no fuman, es decir, en los pacientes no fumadores, realizar actividad física con mayor o menor frecuencia no parece influir en el tiempo de supervivencia.






# Modelo

Se analiza el mejor modelo 
$$
h_i (t) = h_0(t) \cdot e^{\beta_0 + \beta_1 \cdot x_i .....}
$$

\newpage

# Anexo

## Selección de modelos:

Se utilizó el _Test de Razón de Verosimilitud_, con hipótesis de la forma:
$$
H_0) \beta = 0 \quad H_1) \beta \neq 0
$$


### Modelos de una variable
Empezamos con el modelo más simple:

- Modelo nulo o basal:
  - edad = 0 (¿habría que categorizar?)
  - hombre
  - no fumador
  - actividad baja
  - ninguna comorbilidad


$$
h_i(t) = h_0 (t) \quad i = \overline{1,110}
$$

```{r Modelo0, include = F}
# Modelo para graficar
mod_0 <- survfit(Surv(tiempo, complicacion) ~ 1,
                 data = datos)
summary(mod_0)

# Modelo para hacer el test:
modc_0 <- coxph(Surv(tiempo, complicacion) ~ 1,
               ties = "breslow", data = datos)

```


```{r Supervivencia, echo = F,, fig.cap = 'Supervivencia de los pacientes estimada por Kaplan-Meier',  out.width='60%', cache = T}

ggsurvplot(fit = mod_0, data = datos,
           censor.shape = 20,
           xlab = "Tiempo (en meses)",
           ylab = "Probabilidad de Supervivencia estimada",
           legend = "none",
           legend.title = "Gr")

```
\vspace{2em}  

-   Modelo 1: sólo con edad  <!-- VER SI HAY QUE CATEGORIZAR EDAD --> 
$$
    h_i(t) = h_0 (t) \cdot e^{\beta_1 \cdot x_i} \quad i = \overline{1,110}
$$
<!-- CATEGORIZAR EDADES -->
```{r supervivencia1, include = F}
# Para graficar:
# Calcula la función de supervivencia
mod_1 <- survfit(Surv(tiempo, complicacion) ~ edad,
                 data = datos)
summary(mod_1)

```


```{r grafsup1, echo = F,  fig.cap = 'Supervivencia de los pacientes estimada por Kaplan-Meier de acuerdo a las edades',out.width='80%', cache = T}
# No está bueno, capaz podríamos categorizar para poder graficarlo VER nidea qué se hace para continuas 
# ggsurvplot(fit = mod_1, data = datos,
#            censor.shape = 20,
#            xlab = "Tiempo (en meses)",
#            ylab = "Probabilidad de Supervivencia estimada",
#            legend = "none",
#            legend.title = "")

```

```{r testm1, include = F}

# Haciendo el modelo de cox para edad:
modc_1 <- coxph(Surv(tiempo, complicacion) ~ edad, 
               ties = "breslow", data = datos)
summary(modc_1)
# Como los pvalue son muy chicos, RH0


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
test_m1 <- -2*(modc_0$loglik - modc_1$loglik[2])

pchisq(test_m1, df=1, lower.tail = FALSE)

```
Se incluye la variable edad $(p < 0.05)$

\vspace{2em}  

-   Modelo 2: sólo con Sexo ($s_i$ = 0 hombre, $s_i$ = 1 mujer)

$$
h_i(t) = h_0 (t) \cdot e^{\beta_2 \cdot s_i} \quad i = \overline{1,110}
$$

```{r supervivencia2, include = F}
# Supervivencia para graficar
mod_2 <- survfit(Surv(tiempo, complicacion) ~ sexo,
                 data = datos)
summary(mod_2)
```


```{r grafsup2, echo = F, fig.cap = 'Supervivencia de los pacientes estimada por Kaplan-Meier según sexo', out.width='80%', cache = T}

ggsurvplot(fit = mod_2, data = datos,
           censor.shape = 20,
           xlab = "Meses",
           ylab = "Probabilidad de Supervivencia estimada",
           legend.labs = c("Femenino", "Masculino"),
           legend.title = "")

```
Se espera que el tiempo de supervivencia de las mujeres sea mayor que la de los hombres en los primeros 4 años, pero después los tiempos de supervivencia se acercan a los mismos valores. Incluso las pacientes de sexo femenino llegan a tener menores tiempos de supervivencia que los masculinos.

```{r testm2, include = F}

# Haciendo el modelo de cox para sexo:
modc_2 <- coxph(Surv(tiempo, complicacion) ~ sexo, 
               ties = "breslow", data = datos)
summary(modc_2)


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
-2*(modc_0$loglik[1] - modc_2$loglik[2])

pchisq(test_m1, df=1, lower.tail = FALSE)

```

<!-- VER SI DEJAR O BORRAR
$$ 
p-value > 0.05 \Rightarrow  \;No \; Rechazo \; H_0
$$
 -->
La variable Sexo no aporta significativamente a la explicación del tiempo de supervivencia de los pacientes (p > 0.05)


\vspace{2em}  

-   Modelo 3: sólo con Fumador ($f_i$ = 0 No fumador, $f_i$ = 1 Fumador)

$$
h_i(t) = h_0 (t) \cdot e^{\beta_3 \cdot f_i} \quad i = \overline{1,110}
$$

```{r supervivencia3, include = F}
# Modelo para graficar
mod_3 <- survfit(Surv(tiempo, complicacion) ~ fumador,
                 data = datos)
summary(mod_3)
```


```{r grafsup3, echo = F, fig.cap = 'Supervivencia estimada por Kaplan-Meier según si los pacientes son fumadores activos o no',out.width='70%', cache = T}

ggsurvplot(fit = mod_3, data = datos,
           censor.shape = 20,
           xlab = "Meses",
           ylab = "Probabilidad de Supervivencia estimada",
           legend.labs = c("No Fumador", "Fumador"),
           legend.title = "")

```
Los pacientes que no son fumadores muestran tiempos de supervivencia más altos que aquellos que sí fuman activamente.


```{r testm3, include = F}

# Haciendo el modelo de cox para sexo:
modc_3 <- coxph(Surv(tiempo, complicacion) ~ fumador, 
               ties = "breslow", data = datos)
summary(modc_3)


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
-2*(modc_3$loglik[1] - modc_3$loglik[2])


```

La variable Fumador aporta significativamente a la explicación del tiempo de supervivencia de los pacientes $(p < 0.05)$.


\vspace{2em}  

-   Modelo 4: sólo con Actividad 
\begin{tabular}{l c r}
$a_1$ & $a_2$ & \\
\hline
0 & 0  & (Actividad baja)\\
1 & 0  & (Actividad moderada)\\
0 & 1  & (Actividad alta)\\
\end{tabular}



$$
h_i(t) = h_0 (t) \cdot e^{\beta_4 \cdot a_{1i} +
                          \beta_5 \cdot a_{2i}} \quad i = \overline{1,110}
$$

```{r supervivencia4, include = F}
# Modelo para graficar
mod_4 <- survfit(Surv(tiempo, complicacion) ~ actividad,
                 data = datos)
summary(mod_4)
```


```{r grafsup4, echo = F, fig.cap = 'Supervivencia de los pacientes estimada por Kaplan-Meier de acuerdo a los niveles de actividad física', out.width='70%', cache = T}

# ORDENAR ALTA MODERADA BAJA O BAJA MODERADA ALTA
ggsurvplot(fit = mod_4, data = datos,
           censor.shape = 20,
           xlab = "Meses",
           ylab = "Probabilidad de Supervivencia estimada",
           legend.labs = c("Alta", "Baja", "Moderada"),
           legend.title = "")

```
No parece haber grandes diferencias en los tiempos de supervivencia de los pacientes que participaron del estudio que realizaban distintos niveles de actividad física.

```{r testm4, include = F}

# Haciendo el modelo de cox para sexo:
modc_4 <- coxph(Surv(tiempo, complicacion) ~ actividad, 
               ties = "breslow", data = datos)
summary(modc_4)


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
-2*(modc_4$loglik[1] - modc_4$loglik[2])
```

El nivel de actividad física que realice el paciente no aporta significativamente 
$(p > 0.05)$

\vspace{2em}  

-   Modelo 5: sólo con Comorbilidad
\begin{tabular}{l c r}
$c_1$ & $c_2$ & $ $ \\
\hline
0 & 0  & (Pocas comorbilidades)\\
1 & 0  & (Moderadas comorbilidades)\\
0 & 1  & (Muchas comorbilidades)\\
\end{tabular}


$$
h_i(t) = h_0 (t) \cdot e^{\beta_5 \cdot c_{1i} +
                          \beta_6 \cdot c_{2i}}
  \quad i = \overline{1,110}
$$


```{r Modelo5-comorbilidad, include = F}
# Modelo para graficar
# NO ME ACUERDO COMO CATEGORIZABA R VER QUE LO ESTEMOS PONIENDO IGUAL
mod_5 <- survfit(Surv(tiempo, complicacion) ~ comorbilidades,
                 data = datos)
summary(mod_5)

modc_5 <- coxph(Surv(tiempo, complicacion) ~ comorbilidades,
                data = datos, ties = "breslow")
summary(modc_5)

```


```{r Supervivencia_M5, out.width='70%', echo = F}

ggsurvplot(fit = mod_5, data = datos,
           censor.shape = 20,
           xlab = "Meses",
           ylab = "Probabilidad de Supervivencia estimada",
           legend.labs = levels(datos$comorbilidades),
           legend.title = "Comorbilidades")



```
La cantidad de comorbilidades no parece afectar el tiempo de supervivencia de los pacientes $(p > 0.05)$

\vspace{4em}

Dado que la Edad del paciente y si es Fumador activo o no, resultan significativas, resta analizar si ambos aportan en presencia del otro:

- Modelo 6: Edad y Fumador
El modelo de dos variables resultante es el siguiente:
$$
    h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot x_i + \beta_3 \cdot f_i}
$$


```{r Modelo6-Edad-Fumador, include = F}
 # VER SI PONER O NO, MEDIO QUE YA ESTA HECHO ARRIBA
modc_6 <- coxph(Surv(tiempo, complicacion) ~ edad + fumador, 
               ties = "breslow", data = datos)
summary(modc_6)

```

```{r fumadores-vs-edad, include = F}
# Modelo reducido (edad) vs modelo completo(edad y fumadores)
-2*(modc_1$loglik[2] - modc_6$loglik[2])
```
Si fuman o no aporta significativamente cuando está edad.
<!-- VER SI DEJARLO ASÍ O USAR PVALUE -->

```{r edad-vs-fumadores, include = F}
# Modelo reducido (fumadores) vs modelo completo(edad y fumadores)
-2*(modc_3$loglik[2] - modc_6$loglik[2])
```
La edad también aporta cuando está fumador.


<!-- la edad del paciente y si es fumador activo o no afecta al tiempo de supervivencia estimado $(p < 0.05)$. -->



\vspace{2em}  



Ahora se analiza si es correcto agregar alguna variable en presencia de edad y fumador:



### Modelos de tres variables:
-   Modelo 7: Edad, Fumador y sexo

$$
    h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot x_i + \beta_3 \cdot f_i +
    \beta_2 \cdot s_i}
$$


```{r Modelo7-Edad-Fumador-Sexo, include = F}
# Haciendo el modelo de cox para edad, fumador y sexo:
modc_7 <- coxph(Surv(tiempo, complicacion) ~ edad + fumador + sexo, 
               ties = "breslow", data = datos)
summary(modc_7)

-2 * (modc_6$loglik[2] - modc_7$loglik[2])

```
Parece significativo $(p < 0.05)$ usar un modelo que contenga la Edad del paciente, si es Fumador activo o no, y su Sexo biológico.
AUNQUE NO PARECE TAAAAN SIGNIFICATIVA VER SI ESTA BIEN HECHO

-   Modelo 8: Edad, Fumador y Actividad
$$
    h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot x_i + 
                             \beta_3 \cdot f_i +
                           \beta_4 \cdot a_{1i} +
                           \beta_5 \cdot a_{2i}}
$$

```{r Modelo8-Edad-Fumador-Actividad, include = F}

# Haciendo el modelo de cox para sexo:
modc_8 <- coxph(Surv(tiempo, complicacion) ~ edad + fumador + actividad, 
               ties = "breslow", data = datos)
summary(modc_8)


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
-2*(modc_6$loglik[2] - modc_8$loglik[2])
```
LA SENTENCIA DEL SUMMARY TIRA ALGO, PERO CUANDO LO CALCULO A MANO DA BAJO VER
No agregaría nivel de actividad ni sexo

\vspace{2em}  


-   Modelo 9: Edad, Fumador y Comorbilidad 
$$
    h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot x_i +
                             \beta_3 \cdot f_i +
                             \beta_6 \cdot c_i}
$$


```{r Modelo9-Edad-Fumador-Comorbilidades, include = F}

# Haciendo el modelo de cox para sexo:
modc_9 <- coxph(Surv(tiempo, complicacion) ~ edad + fumador + comorbilidades, 
               ties = "breslow", data = datos)
summary(modc_9)


# Test de verosimilitud:
# -2*log(reducido) - log(completo)
-2*(modc_6$loglik[2] - modc_9$loglik[2])
```
Lo mismo que antes, a mano me da chico, diría de no agregarlo, pero la sentencia me da significativa !!!!


\vspace{2em}  

****
Ninguno dio muy significativo, sexo dio un poco significativo, pero tampoco siento que sea taaaan importante ni taaan significativo como para agregarlo VER QUE HACER (si nos quedan 3 variables creo que habría que ver si agregamos las otras o no, y después ver si hay interacción o no)
****








<!-- CREO QUE A PARTIR DE ACÁ NO SERÍA IMPORTANTE. -->


<!-- -   Modelo 10: Edad, Fumador  -->
<!-- $$ -->
<!--     h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot s_i + \beta_2 \cdot f_i} -->
<!-- $$ -->

<!-- ```{r testm10, include = F} -->

<!-- # Haciendo el modelo de cox para sexo: -->
<!-- modc_10 <- coxph(Surv(tiempo, complicacion) ~ sexo + fumador,  -->
<!--                ties = "breslow", data = datos) -->
<!-- summary(modc_10) -->


<!-- # Test de verosimilitud: -->
<!-- # -2*log(reducido) - log(completo) -->
<!-- -2*(modc_10$loglik[1] - modc_10$loglik[2]) -->
<!-- ``` -->

<!-- Con una significación del 5%, puede decirse que el sexo del paciente y si es fumador activo o no afecta al tiempo de supervivencia estimado. -->



<!-- \vspace{2em}   -->

<!-- -   Modelo 11: Sexo y Actividad  -->
<!-- $$ -->
<!--     h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot s_i +  -->
<!--                            \beta_3 \cdot a_{1i} + -->
<!--                            \beta_4 \cdot a_{2i}} -->
<!-- $$ -->

<!-- ```{r testm11, include = F} -->

<!-- # Haciendo el modelo de cox para sexo: -->
<!-- modc_11 <- coxph(Surv(tiempo, complicacion) ~ sexo + actividad,  -->
<!--                ties = "breslow", data = datos) -->
<!-- summary(modc_11) -->


<!-- # Test de verosimilitud: -->
<!-- # -2*log(reducido) - log(completo) -->
<!-- -2*(modc_11$loglik[1] - modc_11$loglik[2]) -->
<!-- ``` -->


<!-- Con una significación del 5%, puede decirse que el sexo biológico del paciente y el nivel de actividad física que realiza afecta al tiempo de supervivencia estimado. -->



<!-- \vspace{2em}   -->

<!-- -   Modelo 12: Sexo y Comorbilidad -->
<!-- $$ -->
<!--     h_i(t) = h_0(t) \cdot e^{\beta_1 \cdot s_i +  -->
<!--                            \beta_3 \cdot a_{1i} + -->
<!--                            \beta_4 \cdot a_{2i}} -->
<!-- $$ -->


<!-- ```{r testm12, include = F} -->

<!-- # Haciendo el modelo de cox para sexo: -->
<!-- modc_12 <- coxph(Surv(tiempo, complicacion) ~ sexo + comorbilidades,  -->
<!--                ties = "breslow", data = datos) -->
<!-- summary(modc_12) -->


<!-- # Test de verosimilitud: -->
<!-- # -2*log(reducido) - log(completo) -->
<!-- -2*modc_12$loglik[1] - modc_12$loglik[2] -->
<!-- ``` -->


<!-- Con una significación del 5%, puede decirse que el sexo y la cantidad de comorbilidades que presentó el paciente afecta al tiempo de supervivencia estimado. -->

\newpage














